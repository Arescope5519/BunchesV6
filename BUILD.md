# Build Instructions for Bunches V6

## Prerequisites

### Required Software

1. **Node.js and npm** - Already installed ✓
2. **Java Development Kit (JDK) 17 or higher** - ⚠️ **REQUIRED** (you currently have Java 13)
3. **Android SDK** - Already installed ✓

### Installing Java 17

Your build is currently failing because Android Gradle Plugin requires Java 17, but you have Java 13 installed.

**Download Java 17:**
- Download from: https://adoptium.net/temurin/releases/?version=17
- Select: Windows x64, JDK, `.msi` installer
- Install to: `C:\Program Files\Java\jdk-17` (or note your installation path)

**Option 1: Set JAVA_HOME Environment Variable (Recommended)**

```powershell
# Set JAVA_HOME for current session
$env:JAVA_HOME = "C:\Program Files\Java\jdk-17"
$env:PATH = "$env:JAVA_HOME\bin;$env:PATH"

# Verify Java version
java -version
# Should show: openjdk version "17.x.x"
```

To set permanently:
1. Open Start Menu → Search "Environment Variables"
2. Click "Edit the system environment variables"
3. Click "Environment Variables" button
4. Under "System variables", click "New"
5. Variable name: `JAVA_HOME`
6. Variable value: `C:\Program Files\Java\jdk-17` (or your actual path)
7. Click OK
8. Find "Path" in System variables, click "Edit"
9. Add new entry: `%JAVA_HOME%\bin`
10. Move it to the top of the list
11. Restart PowerShell

**Option 2: Configure gradle.properties (Quick Fix)**

Add this line to `android/gradle.properties`:
```properties
org.gradle.java.home=C:\\Program Files\\Java\\jdk-17
```
Note: Use double backslashes (`\\`) in the path.

## Building the APK

### Step 1: Clean Start (First Time or After Branch Changes)

Since `android` and `ios` folders are generated by Expo (not in git), you need to regenerate them:

```powershell
# From project root (Y:\PycharmFiles\BunchesV6)

# 1. Remove generated folders
Remove-Item -Recurse -Force android, ios -ErrorAction SilentlyContinue

# 2. Install dependencies (if not already done)
npm install

# 3. Regenerate native folders
npx expo prebuild --clean
```

### Step 2: Build Release APK

```powershell
cd android
.\gradlew assembleRelease
```

The APK will be at: `android\app\build\outputs\apk\release\app-release.apk`

### Step 3: Build Debug APK (Faster, for testing)

```powershell
cd android
.\gradlew assembleDebug
```

The APK will be at: `android\app\build\outputs\apk\debug\app-debug.apk`

## Common Issues

### Issue: Duplicate launcher icon resources (PNG/WebP conflicts)

**Symptoms:**
```
ERROR: [mipmap-hdpi-v4/ic_launcher] ic_launcher.png [mipmap-hdpi-v4/ic_launcher] ic_launcher.webp: Error: Duplicate resources
```

**Solution:**
Old PNG files from a previous build are conflicting with the new WebP files. Clean and rebuild:

```powershell
Remove-Item -Recurse -Force android
npx expo prebuild --clean
cd android
.\gradlew assembleRelease
```

### Issue: CMake codegen directory errors

**Symptoms:**
```
CMake Error: add_subdirectory given source ".../@react-native-async-storage/async-storage/android/build/generated/source/codegen/jni/" which is not an existing directory.
```

**Solution:**
Stale build artifacts. Clean everything:

```powershell
cd android
.\gradlew clean
Remove-Item -Recurse -Force .gradle, app\.cxx, app\build
cd ..
Remove-Item -Recurse -Force android
npx expo prebuild --clean
cd android
.\gradlew assembleRelease
```

### Issue: Java version mismatch

**Symptoms:**
```
Android Gradle plugin requires Java 17 to run. You are currently using Java 13.
```

**Solution:**
See "Installing Java 17" section above.

### Issue: Out of memory during build

**Symptoms:**
```
Daemon will expire after the build after running out of JVM Metaspace.
```

**Solution:**
Increase Gradle memory in `android/gradle.properties`:

```properties
org.gradle.jvmargs=-Xmx4g -XX:MaxMetaspaceSize=1g -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8
```

## Firebase Configuration

The project includes a placeholder `google-services.json` file to allow builds to succeed.

**For production builds**, replace it with your actual Firebase configuration:

1. Go to [Firebase Console](https://console.firebase.google.com/)
2. Select your project
3. Go to Project Settings → Your apps → Android app
4. Download `google-services.json`
5. Replace the file at project root: `google-services.json`

The placeholder will allow the build to complete, but Firebase features (authentication, Firestore) won't work until you use the real configuration.

## Notes

- **Generated folders**: The `android` and `ios` folders are gitignored because Expo generates them from `app.json`
- **Clean builds**: Always regenerate these folders when switching branches or after major changes
- **Build cache**: If you encounter weird errors, try cleaning: `cd android && .\gradlew clean`
